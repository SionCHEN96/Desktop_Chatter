# 🎯 鼠标跟踪功能使用指南

## 功能概述

AI伴侣现在支持鼠标跟踪功能！在闲置状态下，角色会自然地跟随您的鼠标移动，让交互更加生动和真实。

## ✨ 主要特性

### 🎭 智能跟踪
- **头部转动**: 角色头部会跟随鼠标方向转动
- **颈部配合**: 颈部骨骼协调转动，动作更自然
- **眼部跟随**: 眼部骨骼精细跟踪，视线更真实
- **平滑过渡**: 使用插值算法，动作流畅自然

### 🎮 交互方式
- **鼠标移动**: 在角色容器内移动鼠标，角色会跟随
- **鼠标离开**: 鼠标离开容器时，角色逐渐回到默认位置
- **自动回归**: 鼠标静止3秒后，角色自动回到默认姿势

### 🔧 技术特点
- **骨骼检测**: 自动识别头部、颈部、眼部骨骼
- **智能限制**: 转动角度有合理限制，避免不自然的动作
- **性能优化**: 高效的更新算法，不影响渲染性能

## 🎯 使用方法

### 基础使用
1. **启动应用**: 正常启动AI伴侣应用
2. **等待加载**: 等待3D模型完全加载
3. **移动鼠标**: 在角色区域内移动鼠标
4. **观察跟踪**: 角色会自然地看向鼠标位置

### 调试模式
按 `Ctrl + F12` 可以显示/隐藏调试信息，包括：
- 鼠标跟踪状态
- 当前鼠标位置坐标
- 骨骼检测结果
- 实时状态信息

## 🎨 效果展示

### 跟踪范围
- **水平范围**: 左右各约70度 (增强版)
- **垂直范围**: 上下各约50度 (增强版)
- **平滑度**: 5倍插值速度，快速响应

### 骨骼分工
- **头部骨骼**: 主要转动，幅度最大 (0.8倍)
- **颈部骨骼**: 协调转动，幅度较大 (0.7倍)
- **眼部骨骼**: 精确跟踪，幅度完整 (1.0倍)

## 🔧 技术实现

### 骨骼识别
系统会自动识别以下骨骼：
```javascript
// 头部骨骼关键词
'head', '头'

// 颈部骨骼关键词  
'neck', '颈', '脖子'

// 眼部骨骼关键词
'eye', '眼'
```

### 坐标转换
```javascript
// 鼠标坐标转换为标准化坐标 (-1 到 1)
mousePosition.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
mousePosition.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
```

### 角度计算
```javascript
// 目标旋转角度
const targetRotationY = mousePosition.x * 0.3; // 水平转动
const targetRotationX = mousePosition.y * 0.2; // 垂直转动
```

## 📊 性能指标

### 更新频率
- **动画循环**: 60 FPS
- **鼠标事件**: 实时响应
- **调试信息**: 10 FPS (100ms间隔)

### 内存使用
- **骨骼缓存**: 最小化内存占用
- **原始旋转**: 保存初始状态，支持重置
- **事件监听**: 高效的事件处理

## 🎛️ 自定义配置

### 调整跟踪参数
可以在代码中调整以下参数：

```javascript
// 转动幅度 (已优化)
const targetRotationY = mousePosition.x * 0.8; // 水平幅度 (增强版)
const targetRotationX = mousePosition.y * 0.6; // 垂直幅度 (增强版)

// 跟踪速度 (已优化)
const lerpFactor = delta * 5; // 跟踪速度 (增强版)

// 静止超时
const MOUSE_IDLE_TIMEOUT = 3000; // 调整回归时间(毫秒)
```

### 启用/禁用功能
```javascript
import { setMouseTracking } from '../core/character/CharacterContainer.js';

// 启用鼠标跟踪
setMouseTracking(true);

// 禁用鼠标跟踪
setMouseTracking(false);
```

### 获取状态信息
```javascript
import { getMouseTrackingStatus } from '../core/character/CharacterContainer.js';

const status = getMouseTrackingStatus();
console.log('跟踪状态:', status);
```

## 🐛 故障排除

### 常见问题

#### 1. 角色不跟随鼠标
**可能原因**:
- 模型尚未加载完成
- 未找到头部/颈部骨骼
- 鼠标跟踪功能被禁用

**解决方法**:
- 等待模型完全加载
- 按 Ctrl+F12 查看骨骼检测状态
- 检查控制台错误信息

#### 2. 跟踪不够平滑
**可能原因**:
- 性能不足导致帧率下降
- 插值参数设置不当

**解决方法**:
- 降低渲染质量设置
- 调整 lerpFactor 参数

#### 3. 转动角度过大/过小
**可能原因**:
- 转动幅度参数不合适
- 骨骼初始状态异常

**解决方法**:
- 调整 targetRotation 计算参数
- 重新加载模型

### 调试技巧

1. **使用调试模式**: 按 Ctrl+F12 显示实时状态
2. **查看控制台**: 观察骨骼检测和错误信息
3. **检查骨骼**: 确认头部、颈部骨骼是否正确识别
4. **测试范围**: 移动鼠标到容器边缘测试限制

## 🚀 未来扩展

### 计划功能
- **眨眼动画**: 添加自然的眨眼效果
- **表情跟踪**: 根据鼠标位置改变表情
- **语音同步**: 结合语音输入的唇形同步
- **手势跟踪**: 扩展到手部和身体跟踪

### 性能优化
- **LOD系统**: 根据距离调整跟踪精度
- **批量更新**: 优化骨骼更新算法
- **缓存机制**: 减少重复计算

## 📝 总结

鼠标跟踪功能为AI伴侣增添了更多的互动性和真实感。通过智能的骨骼检测和平滑的动画插值，角色能够自然地跟随用户的鼠标移动，创造出更加生动的交互体验。

现在就试试移动鼠标，看看您的AI伴侣如何跟随您的视线吧！🎉
